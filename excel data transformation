import pandas as pd
from googletrans import Translator
import re

# Function to check if text contains English
def contains_english(text):
    return bool(re.search('[a-zA-Z]', text))

# Function to check if text is already in dollars
def is_already_dollar(value):
    return '$' in value and '元' in value

# Function to convert and format currency
def convert_currency(value):
    if is_already_dollar(value):
        # If already in dollars, just remove the 元 character
        return value.replace('元', '')
    elif '¥' in value or '元' in value:
        # Remove Chinese currency symbols and convert
        number = float(re.sub(r'[¥元]', '', value))
        converted = number * 1.1 / 6.3
        return '$' + str(round(converted, 2))
    return value

# Step 1: Import Excel File
file_path = 'path/to/your/excel/file.xlsx'
df = pd.read_excel(file_path)

# Step 2: Change Content
# Initialize Translator
translator = Translator()

# Translate Text and Change Currency
for column in df.columns:
    if df[column].dtype == object:  # Assuming text columns are of object type
        for index, value in df[column].iteritems():
            if value is not None:
                # Convert currency if needed
                value = convert_currency(str(value))

                # Remove English if Chinese is present, then translate
                if contains_english(value) and not is_already_dollar(value):
                    chinese_only = re.sub(r'[a-zA-Z0-9]', '', value)
                    translated_text = translator.translate(chinese_only, dest='en').text
                    df.at[index, column] = translated_text

# Step 3: Export/Change File Name
output_path = 'path/to/your/output/file.xlsx'
df.to_excel(output_path, index=False)

#test case, compare to original file, see if the translate match/ change content code all works.
